{% extends "layout.html" %}

{% block title %}New Capital Injection{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col-12">
            <div class="card dark-card shadow-sm">
                <div class="card-body d-flex align-items-center justify-content-between">
                    <div>
                        <h1 class="h2 mb-0">New Capital Injection</h1>
                        <p class="text-muted mb-0">Treasury-Linked Financial Institution Recapitalization</p>
                    </div>
                    <div>
                        <a href="{{ url_for('recapitalization_dashboard') }}" class="btn btn-outline-primary">
                            <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <div class="card dark-card shadow-sm">
                <div class="card-header bg-gradient-dark">
                    <h4 class="mb-0">Capital Injection Details</h4>
                </div>
                <div class="card-body">
                    <form action="{{ url_for('process_capital_injection') }}" method="post">
                        <!-- Institution Information Section -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="text-gradient mb-3">Institution Information</h5>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="institution_name" class="form-label">Institution Name*</label>
                                <input type="text" class="form-control" id="institution_name" name="institution_name" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="institution_type" class="form-label">Institution Type*</label>
                                <select class="form-select" id="institution_type" name="institution_type" required>
                                    <option value="">Select Institution Type</option>
                                    <option value="commercial_bank">Commercial Bank</option>
                                    <option value="investment_bank">Investment Bank</option>
                                    <option value="credit_union">Credit Union</option>
                                    <option value="microfinance">Microfinance Institution</option>
                                    <option value="savings_bank">Savings Bank</option>
                                    <option value="community_bank">Community Bank</option>
                                    <option value="cooperative_bank">Cooperative Bank</option>
                                    <option value="regional_bank">Regional Bank</option>
                                    <option value="national_bank">National Bank</option>
                                    <option value="international_bank">International Bank</option>
                                    <option value="development_bank">Development Bank</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="registration_number" class="form-label">Registration Number</label>
                                <input type="text" class="form-control" id="registration_number" name="registration_number">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="regulatory_framework" class="form-label">Regulatory Framework*</label>
                                <select class="form-select" id="regulatory_framework" name="regulatory_framework" required>
                                    <option value="">Select Regulatory Framework</option>
                                    <option value="basel_iii">Basel III</option>
                                    <option value="basel_iv">Basel IV</option>
                                    <option value="dodd_frank">Dodd-Frank</option>
                                    <option value="eu_crd_iv">EU CRD IV</option>
                                    <option value="uk_pra">UK PRA</option>
                                    <option value="australia_apra">Australia APRA</option>
                                    <option value="canada_osfi">Canada OSFI</option>
                                    <option value="japan_fsa">Japan FSA</option>
                                    <option value="china_cbrc">China CBRC</option>
                                    <option value="india_rbi">India RBI</option>
                                    <option value="nigeria_cbn">Nigeria CBN</option>
                                    <option value="african_regional">African Regional</option>
                                    <option value="national_specific">National Specific</option>
                                </select>
                            </div>
                        </div>

                        <!-- Capital Details Section -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="text-gradient mb-3">Capital Injection Details</h5>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="capital_type" class="form-label">Capital Type*</label>
                                <select class="form-select" id="capital_type" name="capital_type" required>
                                    <option value="">Select Capital Type</option>
                                    <option value="tier1_equity">Tier 1 Equity Capital</option>
                                    <option value="tier1_additional">Tier 1 Additional Capital</option>
                                    <option value="tier2">Tier 2 Capital</option>
                                    <option value="capital_conservation_buffer">Capital Conservation Buffer</option>
                                    <option value="countercyclical_buffer">Countercyclical Buffer</option>
                                    <option value="systemic_risk_buffer">Systemic Risk Buffer</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="investment_structure" class="form-label">Investment Structure*</label>
                                <select class="form-select" id="investment_structure" name="investment_structure" required>
                                    <option value="">Select Investment Structure</option>
                                    <option value="common_equity">Common Equity</option>
                                    <option value="preferred_shares">Preferred Shares</option>
                                    <option value="subordinated_debt">Subordinated Debt</option>
                                    <option value="convertible_debt">Convertible Debt</option>
                                    <option value="contingent_convertible">Contingent Convertible (CoCo)</option>
                                    <option value="perpetual_bond">Perpetual Bond</option>
                                    <option value="hybrid_instrument">Hybrid Instrument</option>
                                    <option value="equity_investment">Equity Investment</option>
                                    <option value="term_loan">Term Loan</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="requested_amount" class="form-label">Amount (USD, millions)*</label>
                                <input type="number" step="0.01" min="10" max="100000" class="form-control" id="requested_amount" name="requested_amount" required>
                                <small class="form-text text-muted">Range: $10M - $100B USD</small>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="term_years" class="form-label">Term (Years)*</label>
                                <input type="number" class="form-control" id="term_years" name="term_years" min="1" max="30" required>
                                <small class="form-text text-muted">1-30 years depending on investment type</small>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="proposed_rate" class="form-label">Proposed Rate (%)*</label>
                                <input type="number" step="0.1" min="0" max="20" class="form-control" id="proposed_rate" name="proposed_rate" required>
                                <small class="form-text text-muted">Interest rate for debt or dividend rate for equity</small>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="regulatory_concern" class="form-label">Primary Regulatory Concern</label>
                                <select class="form-select" id="regulatory_concern" name="regulatory_concern">
                                    <option value="">Select Regulatory Concern</option>
                                    <option value="capital_adequacy">Capital Adequacy</option>
                                    <option value="liquidity">Liquidity</option>
                                    <option value="asset_quality">Asset Quality</option>
                                    <option value="management">Management</option>
                                    <option value="earnings">Earnings</option>
                                    <option value="sensitivity_to_market_risk">Sensitivity to Market Risk</option>
                                    <option value="compliance">Compliance</option>
                                    <option value="operational_risk">Operational Risk</option>
                                    <option value="systemic_risk">Systemic Risk</option>
                                    <option value="nigeria_cbn_compliance">Nigeria CBN Compliance</option>
                                    <option value="nigeria_bofia_requirements">Nigeria BOFIA Requirements</option>
                                    <option value="nigeria_frc_standards">Nigeria FRC Standards</option>
                                    <option value="nigeria_foreign_exchange">Nigeria Foreign Exchange Exposure</option>
                                    <option value="nigeria_sectoral_lending">Nigeria Sectoral Lending Requirements</option>
                                </select>
                            </div>
                        </div>

                        <!-- Financial Information Section -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="text-gradient mb-3">Financial Information</h5>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="total_assets" class="form-label">Total Assets (USD, millions)*</label>
                                <input type="number" step="0.01" min="0" class="form-control" id="total_assets" name="total_assets" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="total_liabilities" class="form-label">Total Liabilities (USD, millions)*</label>
                                <input type="number" step="0.01" min="0" class="form-control" id="total_liabilities" name="total_liabilities" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="total_equity" class="form-label">Total Equity (USD, millions)*</label>
                                <input type="number" step="0.01" min="0" class="form-control" id="total_equity" name="total_equity" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="tier1_capital" class="form-label">Current Tier 1 Capital (USD, millions)*</label>
                                <input type="number" step="0.01" min="0" class="form-control" id="tier1_capital" name="tier1_capital" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="tier2_capital" class="form-label">Current Tier 2 Capital (USD, millions)*</label>
                                <input type="number" step="0.01" min="0" class="form-control" id="tier2_capital" name="tier2_capital" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="risk_weighted_assets" class="form-label">Risk Weighted Assets (USD, millions)*</label>
                                <input type="number" step="0.01" min="0" class="form-control" id="risk_weighted_assets" name="risk_weighted_assets" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="current_capital_ratio" class="form-label">Current Capital Ratio (%)*</label>
                                <input type="number" step="0.01" min="0" max="100" class="form-control" id="current_capital_ratio" name="current_capital_ratio" required>
                            </div>
                        </div>
                        
                        <!-- Nigeria-Specific Regulatory Requirements Section - Only shown when Nigeria is selected -->
                        <div class="row mb-4" id="nigeria-section">
                            <div class="col-12">
                                <h5 class="text-gradient mb-3">Nigeria-Specific Regulatory Requirements</h5>
                                <p class="text-muted small mb-3">Complete this section if the financial institution is regulated by the Central Bank of Nigeria (CBN)</p>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="nigeria_cbn_license_type" class="form-label">CBN License Type</label>
                                <select class="form-select" id="nigeria_cbn_license_type" name="nigeria_cbn_license_type">
                                    <option value="">Select License Type</option>
                                    <option value="commercial_national">Commercial Bank - National</option>
                                    <option value="commercial_regional">Commercial Bank - Regional</option>
                                    <option value="merchant">Merchant Bank</option>
                                    <option value="non_interest">Non-Interest Bank</option>
                                    <option value="microfinance">Microfinance Bank</option>
                                    <option value="development">Development Bank</option>
                                    <option value="primary_mortgage">Primary Mortgage Bank</option>
                                    <option value="payment_service">Payment Service Bank</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="nigeria_cbn_composite_risk_rating" class="form-label">CBN Composite Risk Rating</label>
                                <select class="form-select" id="nigeria_cbn_composite_risk_rating" name="nigeria_cbn_composite_risk_rating">
                                    <option value="">Select Rating</option>
                                    <option value="low">Low</option>
                                    <option value="moderate">Moderate</option>
                                    <option value="above_average">Above Average</option>
                                    <option value="high">High</option>
                                    <option value="unsatisfactory">Unsatisfactory</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="nigeria_cbn_camel_rating" class="form-label">CBN CAMEL Rating</label>
                                <select class="form-select" id="nigeria_cbn_camel_rating" name="nigeria_cbn_camel_rating">
                                    <option value="">Select Rating</option>
                                    <option value="1">1 - Strong</option>
                                    <option value="2">2 - Satisfactory</option>
                                    <option value="3">3 - Fair</option>
                                    <option value="4">4 - Marginal</option>
                                    <option value="5">5 - Unsatisfactory</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="nigeria_cbn_liquidity_ratio" class="form-label">Liquidity Ratio (%)</label>
                                <input type="number" step="0.01" min="0" max="100" class="form-control" id="nigeria_cbn_liquidity_ratio" name="nigeria_cbn_liquidity_ratio">
                                <small class="form-text text-muted">CBN minimum requirement: 30%</small>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="nigeria_cash_reserve_ratio" class="form-label">Cash Reserve Ratio (%)</label>
                                <input type="number" step="0.01" min="0" max="100" class="form-control" id="nigeria_cash_reserve_ratio" name="nigeria_cash_reserve_ratio">
                                <small class="form-text text-muted">Current CBN requirement: 27.5%</small>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="nigeria_loan_to_deposit_ratio" class="form-label">Loan-to-Deposit Ratio (%)</label>
                                <input type="number" step="0.01" min="0" max="100" class="form-control" id="nigeria_loan_to_deposit_ratio" name="nigeria_loan_to_deposit_ratio">
                                <small class="form-text text-muted">CBN minimum requirement: 65%</small>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="nigeria_sectoral_allocation" class="form-label">Sectoral Allocation Compliance</label>
                                <select class="form-select" id="nigeria_sectoral_allocation" name="nigeria_sectoral_allocation">
                                    <option value="">Select Status</option>
                                    <option value="compliant">Fully Compliant</option>
                                    <option value="partially_compliant">Partially Compliant</option>
                                    <option value="non_compliant">Non-Compliant</option>
                                </select>
                                <small class="form-text text-muted">Compliance with CBN sectoral allocation requirements</small>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="nigeria_fx_exposure" class="form-label">Foreign Exchange Exposure (%)</label>
                                <input type="number" step="0.01" min="0" class="form-control" id="nigeria_fx_exposure" name="nigeria_fx_exposure">
                                <small class="form-text text-muted">Percentage of capital exposed to foreign exchange risk</small>
                            </div>
                        </div>

                        <!-- Use of Funds Section -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="text-gradient mb-3">Use of Funds</h5>
                            </div>
                            <div class="col-md-12 mb-3">
                                <label for="use_of_funds" class="form-label">Detailed Use of Funds*</label>
                                <textarea class="form-control" id="use_of_funds" name="use_of_funds" rows="4" required></textarea>
                                <small class="form-text text-muted">Describe how the capital will be utilized</small>
                            </div>
                            <div class="col-md-12 mb-3">
                                <label for="expected_impact" class="form-label">Expected Impact on Financial Position*</label>
                                <textarea class="form-control" id="expected_impact" name="expected_impact" rows="4" required></textarea>
                                <small class="form-text text-muted">Describe the anticipated improvements to capital position and operations</small>
                            </div>
                        </div>

                        <!-- Contact Information Section -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="text-gradient mb-3">Primary Contact Information</h5>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="contact_name" class="form-label">Contact Name*</label>
                                <input type="text" class="form-control" id="contact_name" name="contact_name" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="contact_title" class="form-label">Contact Title*</label>
                                <input type="text" class="form-control" id="contact_title" name="contact_title" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="contact_email" class="form-label">Contact Email*</label>
                                <input type="email" class="form-control" id="contact_email" name="contact_email" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="contact_phone" class="form-label">Contact Phone*</label>
                                <input type="tel" class="form-control" id="contact_phone" name="contact_phone" required>
                            </div>
                        </div>

                        <!-- Submission Button Section -->
                        <div class="row">
                            <div class="col-12 text-center">
                                <button type="submit" class="btn btn-primary btn-lg px-5">
                                    <i class="fas fa-paper-plane me-2"></i>Submit Capital Injection Application
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Form validation script -->
<script>
    // Form validation would be implemented here in a real application
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.querySelector('form');
        form.addEventListener('submit', function(event) {
            // This is a simplified form submission for demonstration
            event.preventDefault();
            alert('Capital injection application submitted successfully!');
            window.location.href = '{{ url_for("recapitalization_dashboard") }}';
        });
    });
</script>
{% endblock %}