{% extends "base.html" %}

{% block title %}Comprehensive Loan Application{% endblock %}

{% block styles %}
<style>
    .form-section {
        background-color: rgba(0, 40, 85, 0.03);
        border-radius: 8px;
        border: 1px solid rgba(0, 40, 85, 0.1);
        padding: 20px;
        margin-bottom: 25px;
    }
    
    .form-section h4 {
        color: #004080;
        margin-bottom: 20px;
        border-bottom: 1px solid #dee2e6;
        padding-bottom: 10px;
    }
    
    .field-help {
        font-size: 0.85em;
        color: #666;
        margin-top: 3px;
    }
    
    .contact-card, .financial-card, .management-card {
        background-color: rgba(0, 40, 85, 0.01);
        border-radius: 6px;
        border: 1px solid rgba(0, 40, 85, 0.05);
        padding: 15px;
        margin-bottom: 15px;
        position: relative;
    }
    
    .dynamic-formset-add {
        margin-bottom: 15px;
    }
    
    .remove-formset {
        position: absolute;
        top: 10px;
        right: 10px;
        color: #dc3545;
        cursor: pointer;
    }
    
    .tab-content {
        padding-top: 20px;
    }
    
    /* Info box styles */
    .info-box {
        background-color: rgba(0, 123, 255, 0.1);
        border-left: 4px solid rgba(0, 123, 255, 1);
        padding: 15px;
        margin: 20px 0;
        border-radius: 4px;
    }
    
    /* Custom styling for the tab design */
    .nav-tabs {
        border-bottom: 2px solid #dee2e6;
    }
    
    .nav-tabs .nav-link {
        border: none;
        color: #495057;
        padding: 10px 20px;
        margin-right: 5px;
        border-radius: 4px 4px 0 0;
    }
    
    .nav-tabs .nav-link:hover {
        background-color: rgba(0, 40, 85, 0.05);
        border-color: transparent;
    }
    
    .nav-tabs .nav-link.active {
        color: #004080;
        background-color: #fff;
        border-bottom: 3px solid #004080;
        border-top: none;
        border-left: none;
        border-right: none;
        font-weight: bold;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4 mb-5">
    <div class="row">
        <div class="col-md-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>Comprehensive Loan Application</h2>
                <div>
                    <a href="{{ url_for('simple_loan.index') }}" class="btn btn-outline-primary">
                        <i class="fas fa-arrow-left me-1"></i> Back to Loans
                    </a>
                </div>
            </div>
            
            <div class="info-box">
                <h5><i class="fas fa-info-circle me-2"></i>About This Application</h5>
                <p class="mb-0">This comprehensive loan application is designed for large institutional loans ranging from $10M to $100B. Please complete all sections accurately and attach the required documentation. Our underwriting team will evaluate your application based on provided information.</p>
            </div>
            
            <form method="POST" enctype="multipart/form-data" id="comprehensiveLoanForm">
                {{ form.csrf_token }}
                
                <ul class="nav nav-tabs" id="applicationTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="basic-tab" data-bs-toggle="tab" data-bs-target="#basic" type="button" role="tab" aria-controls="basic" aria-selected="true">
                            <i class="fas fa-file-alt me-2"></i>Basic Information
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="borrower-tab" data-bs-toggle="tab" data-bs-target="#borrower" type="button" role="tab" aria-controls="borrower" aria-selected="false">
                            <i class="fas fa-building me-2"></i>Borrower Details
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="financial-tab" data-bs-toggle="tab" data-bs-target="#financial" type="button" role="tab" aria-controls="financial" aria-selected="false">
                            <i class="fas fa-chart-line me-2"></i>Financial Information
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="collateral-tab" data-bs-toggle="tab" data-bs-target="#collateral" type="button" role="tab" aria-controls="collateral" aria-selected="false">
                            <i class="fas fa-shield-alt me-2"></i>Collateral
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="documents-tab" data-bs-toggle="tab" data-bs-target="#documents" type="button" role="tab" aria-controls="documents" aria-selected="false">
                            <i class="fas fa-file-upload me-2"></i>Documents
                        </button>
                    </li>
                </ul>
                
                <div class="tab-content" id="applicationTabsContent">
                    <!-- Basic Loan Information Tab -->
                    <div class="tab-pane fade show active" id="basic" role="tabpanel" aria-labelledby="basic-tab">
                        <div class="form-section">
                            <h4>Basic Loan Information</h4>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group mb-3">
                                        {{ form.loan_amount.label(class="form-label") }}
                                        {{ form.loan_amount(class="form-control") }}
                                        {% if form.loan_amount.description %}
                                        <div class="field-help">{{ form.loan_amount.description }}</div>
                                        {% endif %}
                                        {% if form.loan_amount.errors %}
                                        <div class="text-danger">
                                            {% for error in form.loan_amount.errors %}
                                            <span>{{ error }}</span>
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="form-group mb-3">
                                        {{ form.currency.label(class="form-label") }}
                                        {{ form.currency(class="form-select") }}
                                        {% if form.currency.errors %}
                                        <div class="text-danger">
                                            {% for error in form.currency.errors %}
                                            <span>{{ error }}</span>
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group mb-3">
                                        {{ form.term_years.label(class="form-label") }}
                                        {{ form.term_years(class="form-control") }}
                                        {% if form.term_years.description %}
                                        <div class="field-help">{{ form.term_years.description }}</div>
                                        {% endif %}
                                        {% if form.term_years.errors %}
                                        <div class="text-danger">
                                            {% for error in form.term_years.errors %}
                                            <span>{{ error }}</span>
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="form-group mb-3">
                                        {{ form.interest_rate.label(class="form-label") }}
                                        {{ form.interest_rate(class="form-control") }}
                                        {% if form.interest_rate.description %}
                                        <div class="field-help">{{ form.interest_rate.description }}</div>
                                        {% endif %}
                                        {% if form.interest_rate.errors %}
                                        <div class="text-danger">
                                            {% for error in form.interest_rate.errors %}
                                            <span>{{ error }}</span>
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group mb-3">
                                        {{ form.interest_payment_frequency.label(class="form-label") }}
                                        {{ form.interest_payment_frequency(class="form-select") }}
                                        {% if form.interest_payment_frequency.errors %}
                                        <div class="text-danger">
                                            {% for error in form.interest_payment_frequency.errors %}
                                            <span>{{ error }}</span>
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group mb-3">
                                {{ form.loan_purpose.label(class="form-label") }}
                                {{ form.loan_purpose(class="form-control", rows=4) }}
                                {% if form.loan_purpose.description %}
                                <div class="field-help">{{ form.loan_purpose.description }}</div>
                                {% endif %}
                                {% if form.loan_purpose.errors %}
                                <div class="text-danger">
                                    {% for error in form.loan_purpose.errors %}
                                    <span>{{ error }}</span>
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Borrower Details Tab -->
                    <div class="tab-pane fade" id="borrower" role="tabpanel" aria-labelledby="borrower-tab">
                        <div class="form-section">
                            <h4>Borrower Information</h4>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group mb-3">
                                        {{ form.borrower_name.label(class="form-label") }}
                                        {{ form.borrower_name(class="form-control") }}
                                        {% if form.borrower_name.errors %}
                                        <div class="text-danger">
                                            {% for error in form.borrower_name.errors %}
                                            <span>{{ error }}</span>
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="form-group mb-3">
                                        {{ form.borrower_entity_type.label(class="form-label") }}
                                        {{ form.borrower_entity_type(class="form-select") }}
                                        {% if form.borrower_entity_type.errors %}
                                        <div class="text-danger">
                                            {% for error in form.borrower_entity_type.errors %}
                                            <span>{{ error }}</span>
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group mb-3">
                                        {{ form.borrower_tax_id.label(class="form-label") }}
                                        {{ form.borrower_tax_id(class="form-control") }}
                                        {% if form.borrower_tax_id.errors %}
                                        <div class="text-danger">
                                            {% for error in form.borrower_tax_id.errors %}
                                            <span>{{ error }}</span>
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="form-group mb-3">
                                        {{ form.borrower_industry.label(class="form-label") }}
                                        {{ form.borrower_industry(class="form-select") }}
                                        {% if form.borrower_industry.errors %}
                                        <div class="text-danger">
                                            {% for error in form.borrower_industry.errors %}
                                            <span>{{ error }}</span>
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group mb-3">
                                        {{ form.years_in_business.label(class="form-label") }}
                                        {{ form.years_in_business(class="form-control") }}
                                        {% if form.years_in_business.description %}
                                        <div class="field-help">{{ form.years_in_business.description }}</div>
                                        {% endif %}
                                        {% if form.years_in_business.errors %}
                                        <div class="text-danger">
                                            {% for error in form.years_in_business.errors %}
                                            <span>{{ error }}</span>
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <div class="col-md-4">
                                    <div class="form-group mb-3">
                                        {{ form.number_of_employees.label(class="form-label") }}
                                        {{ form.number_of_employees(class="form-control") }}
                                        {% if form.number_of_employees.description %}
                                        <div class="field-help">{{ form.number_of_employees.description }}</div>
                                        {% endif %}
                                        {% if form.number_of_employees.errors %}
                                        <div class="text-danger">
                                            {% for error in form.number_of_employees.errors %}
                                            <span>{{ error }}</span>
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <div class="col-md-4">
                                    <div class="form-group mb-3">
                                        {{ form.borrower_website.label(class="form-label") }}
                                        {{ form.borrower_website(class="form-control") }}
                                        {% if form.borrower_website.errors %}
                                        <div class="text-danger">
                                            {% for error in form.borrower_website.errors %}
                                            <span>{{ error }}</span>
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group mb-3">
                                {{ form.borrower_address.label(class="form-label") }}
                                {{ form.borrower_address(class="form-control", rows=3) }}
                                {% if form.borrower_address.errors %}
                                <div class="text-danger">
                                    {% for error in form.borrower_address.errors %}
                                    <span>{{ error }}</span>
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>
                            
                            <h5 class="mt-4 mb-3">Primary Contact Information</h5>
                            
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group mb-3">
                                        {{ form.borrower_contact_name.label(class="form-label") }}
                                        {{ form.borrower_contact_name(class="form-control") }}
                                        {% if form.borrower_contact_name.errors %}
                                        <div class="text-danger">
                                            {% for error in form.borrower_contact_name.errors %}
                                            <span>{{ error }}</span>
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <div class="col-md-4">
                                    <div class="form-group mb-3">
                                        {{ form.borrower_contact_email.label(class="form-label") }}
                                        {{ form.borrower_contact_email(class="form-control") }}
                                        {% if form.borrower_contact_email.errors %}
                                        <div class="text-danger">
                                            {% for error in form.borrower_contact_email.errors %}
                                            <span>{{ error }}</span>
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <div class="col-md-4">
                                    <div class="form-group mb-3">
                                        {{ form.borrower_contact_phone.label(class="form-label") }}
                                        {{ form.borrower_contact_phone(class="form-control") }}
                                        {% if form.borrower_contact_phone.errors %}
                                        <div class="text-danger">
                                            {% for error in form.borrower_contact_phone.errors %}
                                            <span>{{ error }}</span>
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Financial Information Tab -->
                    <div class="tab-pane fade" id="financial" role="tabpanel" aria-labelledby="financial-tab">
                        <div class="form-section">
                            <h4>Financial Information</h4>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group mb-3">
                                        {{ form.annual_revenue.label(class="form-label") }}
                                        {{ form.annual_revenue(class="form-control") }}
                                        {% if form.annual_revenue.description %}
                                        <div class="field-help">{{ form.annual_revenue.description }}</div>
                                        {% endif %}
                                        {% if form.annual_revenue.errors %}
                                        <div class="text-danger">
                                            {% for error in form.annual_revenue.errors %}
                                            <span>{{ error }}</span>
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="form-group mb-3">
                                        {{ form.annual_net_income.label(class="form-label") }}
                                        {{ form.annual_net_income(class="form-control") }}
                                        {% if form.annual_net_income.description %}
                                        <div class="field-help">{{ form.annual_net_income.description }}</div>
                                        {% endif %}
                                        {% if form.annual_net_income.errors %}
                                        <div class="text-danger">
                                            {% for error in form.annual_net_income.errors %}
                                            <span>{{ error }}</span>
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group mb-3">
                                        {{ form.years_profitable.label(class="form-label") }}
                                        {{ form.years_profitable(class="form-control") }}
                                        {% if form.years_profitable.description %}
                                        <div class="field-help">{{ form.years_profitable.description }}</div>
                                        {% endif %}
                                        {% if form.years_profitable.errors %}
                                        <div class="text-danger">
                                            {% for error in form.years_profitable.errors %}
                                            <span>{{ error }}</span>
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <div class="col-md-4">
                                    <div class="form-group mb-3">
                                        {{ form.credit_rating.label(class="form-label") }}
                                        {{ form.credit_rating(class="form-select") }}
                                        {% if form.credit_rating.errors %}
                                        <div class="text-danger">
                                            {% for error in form.credit_rating.errors %}
                                            <span>{{ error }}</span>
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <h5 class="mt-4 mb-3">Credit History</h5>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-check mb-3">
                                        {{ form.has_previous_bankruptcy(class="form-check-input") }}
                                        {{ form.has_previous_bankruptcy.label(class="form-check-label") }}
                                        {% if form.has_previous_bankruptcy.description %}
                                        <div class="field-help">{{ form.has_previous_bankruptcy.description }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <div id="bankruptcyDetails" class="mb-3 {% if not form.has_previous_bankruptcy.data %}d-none{% endif %}">
                                        {{ form.bankruptcy_details.label(class="form-label") }}
                                        {{ form.bankruptcy_details(class="form-control", rows=3) }}
                                        {% if form.bankruptcy_details.description %}
                                        <div class="field-help">{{ form.bankruptcy_details.description }}</div>
                                        {% endif %}
                                        {% if form.bankruptcy_details.errors %}
                                        <div class="text-danger">
                                            {% for error in form.bankruptcy_details.errors %}
                                            <span>{{ error }}</span>
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="form-check mb-3">
                                        {{ form.has_previous_defaults(class="form-check-input") }}
                                        {{ form.has_previous_defaults.label(class="form-check-label") }}
                                        {% if form.has_previous_defaults.description %}
                                        <div class="field-help">{{ form.has_previous_defaults.description }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <div id="defaultDetails" class="mb-3 {% if not form.has_previous_defaults.data %}d-none{% endif %}">
                                        {{ form.default_details.label(class="form-label") }}
                                        {{ form.default_details(class="form-control", rows=3) }}
                                        {% if form.default_details.description %}
                                        <div class="field-help">{{ form.default_details.description }}</div>
                                        {% endif %}
                                        {% if form.default_details.errors %}
                                        <div class="text-danger">
                                            {% for error in form.default_details.errors %}
                                            <span>{{ error }}</span>
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Collateral Tab -->
                    <div class="tab-pane fade" id="collateral" role="tabpanel" aria-labelledby="collateral-tab">
                        <div class="form-section">
                            <h4>Collateral Information</h4>
                            
                            <div class="form-check mb-3">
                                {{ form.collateral_available(class="form-check-input") }}
                                {{ form.collateral_available.label(class="form-check-label") }}
                                {% if form.collateral_available.description %}
                                <div class="field-help">{{ form.collateral_available.description }}</div>
                                {% endif %}
                            </div>
                            
                            <div id="collateralSection" class="{% if not form.collateral_available.data %}d-none{% endif %}">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group mb-3">
                                            {{ form.collateral_types.label(class="form-label") }}
                                            {{ form.collateral_types(class="form-select") }}
                                            {% if form.collateral_types.errors %}
                                            <div class="text-danger">
                                                {% for error in form.collateral_types.errors %}
                                                <span>{{ error }}</span>
                                                {% endfor %}
                                            </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <div class="form-group mb-3">
                                            {{ form.collateral_value.label(class="form-label") }}
                                            {{ form.collateral_value(class="form-control") }}
                                            {% if form.collateral_value.description %}
                                            <div class="field-help">{{ form.collateral_value.description }}</div>
                                            {% endif %}
                                            {% if form.collateral_value.errors %}
                                            <div class="text-danger">
                                                {% for error in form.collateral_value.errors %}
                                                <span>{{ error }}</span>
                                                {% endfor %}
                                            </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group mb-3">
                                    {{ form.collateral_description.label(class="form-label") }}
                                    {{ form.collateral_description(class="form-control", rows=4) }}
                                    {% if form.collateral_description.description %}
                                    <div class="field-help">{{ form.collateral_description.description }}</div>
                                    {% endif %}
                                    {% if form.collateral_description.errors %}
                                    <div class="text-danger">
                                        {% for error in form.collateral_description.errors %}
                                        <span>{{ error }}</span>
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="form-check mb-3 mt-4">
                                {{ form.has_personal_guarantee(class="form-check-input") }}
                                {{ form.has_personal_guarantee.label(class="form-check-label") }}
                                {% if form.has_personal_guarantee.description %}
                                <div class="field-help">{{ form.has_personal_guarantee.description }}</div>
                                {% endif %}
                            </div>
                            
                            <h5 class="mt-4 mb-3">Self-Liquidating Mechanism</h5>
                            
                            <div class="form-group mb-3">
                                {{ form.liquidation_mechanism_description.label(class="form-label") }}
                                {{ form.liquidation_mechanism_description(class="form-control", rows=4) }}
                                {% if form.liquidation_mechanism_description.description %}
                                <div class="field-help">{{ form.liquidation_mechanism_description.description }}</div>
                                {% endif %}
                                {% if form.liquidation_mechanism_description.errors %}
                                <div class="text-danger">
                                    {% for error in form.liquidation_mechanism_description.errors %}
                                    <span>{{ error }}</span>
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Documents Tab -->
                    <div class="tab-pane fade" id="documents" role="tabpanel" aria-labelledby="documents-tab">
                        <div class="form-section">
                            <h4>Required Documents</h4>
                            <p class="text-muted mb-4">Please upload the following documents to support your loan application. All documents should be in PDF, DOC, DOCX, XLS, XLSX, JPG, JPEG, or PNG format.</p>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group mb-4">
                                        {{ form.business_registration_document.label(class="form-label") }}
                                        {{ form.business_registration_document(class="form-control") }}
                                        <div class="field-help">Business registration certificate, articles of incorporation, or similar document</div>
                                        {% if form.business_registration_document.errors %}
                                        <div class="text-danger">
                                            {% for error in form.business_registration_document.errors %}
                                            <span>{{ error }}</span>
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="form-group mb-4">
                                        {{ form.financial_statements_document.label(class="form-label") }}
                                        {{ form.financial_statements_document(class="form-control") }}
                                        <div class="field-help">Most recent audited financial statements</div>
                                        {% if form.financial_statements_document.errors %}
                                        <div class="text-danger">
                                            {% for error in form.financial_statements_document.errors %}
                                            <span>{{ error }}</span>
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group mb-4">
                                        {{ form.tax_returns_document.label(class="form-label") }}
                                        {{ form.tax_returns_document(class="form-control") }}
                                        <div class="field-help">Last 3 years of tax returns</div>
                                        {% if form.tax_returns_document.errors %}
                                        <div class="text-danger">
                                            {% for error in form.tax_returns_document.errors %}
                                            <span>{{ error }}</span>
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="form-group mb-4">
                                        {{ form.business_plan_document.label(class="form-label") }}
                                        {{ form.business_plan_document(class="form-control") }}
                                        <div class="field-help">Business plan including use of loan proceeds</div>
                                        {% if form.business_plan_document.errors %}
                                        <div class="text-danger">
                                            {% for error in form.business_plan_document.errors %}
                                            <span>{{ error }}</span>
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group mb-4">
                                        {{ form.collateral_document.label(class="form-label") }}
                                        {{ form.collateral_document(class="form-control") }}
                                        <div class="field-help">Documentation supporting collateral valuation</div>
                                        {% if form.collateral_document.errors %}
                                        <div class="text-danger">
                                            {% for error in form.collateral_document.errors %}
                                            <span>{{ error }}</span>
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-check mt-4 mb-4">
                                {{ form.terms_accepted(class="form-check-input") }}
                                {{ form.terms_accepted.label(class="form-check-label") }}
                                {% if form.terms_accepted.errors %}
                                <div class="text-danger">
                                    {% for error in form.terms_accepted.errors %}
                                    <span>{{ error }}</span>
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>
                            
                            <div class="text-center">
                                {{ form.submit(class="btn btn-primary btn-lg px-5") }}
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Show/hide collateral details based on availability checkbox
        document.getElementById('collateral_available').addEventListener('change', function() {
            document.getElementById('collateralSection').classList.toggle('d-none', !this.checked);
        });
        
        // Show/hide bankruptcy details
        document.getElementById('has_previous_bankruptcy').addEventListener('change', function() {
            document.getElementById('bankruptcyDetails').classList.toggle('d-none', !this.checked);
        });
        
        // Show/hide default details
        document.getElementById('has_previous_defaults').addEventListener('change', function() {
            document.getElementById('defaultDetails').classList.toggle('d-none', !this.checked);
        });
        
        // Tab navigation with validation
        let currentTab = 0;
        const tabs = document.querySelectorAll('#applicationTabs button[data-bs-toggle="tab"]');
        
        // Listen for tab clicks
        tabs.forEach((tab, index) => {
            tab.addEventListener('click', function(event) {
                // Get the currently active tab index
                const activeTab = document.querySelector('#applicationTabs button.active');
                const currentTabIndex = Array.from(tabs).indexOf(activeTab);
                
                // Only validate if moving forward
                if (index > currentTabIndex) {
                    // Here we would validate the current tab fields
                    // For now, just allow the tab change
                }
            });
        });
        
        // Add form validation before submit
        document.getElementById('comprehensiveLoanForm').addEventListener('submit', function(event) {
            // Check if terms are accepted
            if (!document.getElementById('terms_accepted').checked) {
                event.preventDefault();
                alert('You must accept the terms and conditions to submit the application.');
                return false;
            }
            
            // Additional validation could be added here
            return true;
        });
    });
</script>
{% endblock %}